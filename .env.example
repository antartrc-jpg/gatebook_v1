# FILE: .env.example
# GateBook Enterprise — ADM · Dev-Umgebung (W1 · Theme-UX Final)
# Zweck:
# • Einheitliche ENV für API (Fastify) & Web (Next.js).
# • Aktiviert Live-Themes vom Server und entspannt den Guard in DEV,
#   damit Speichern im Drawer funktioniert.
# • Diese Datei als ".env" INS REPO-ROOT kopieren (nicht in apps/web!).

################################################################################
# APP / ORIGINS
################################################################################

# Öffentliche Web-App (Next.js DEV-Port: 3001 gemäß W1-Setup)
APP_BASE_URL=http://localhost:3001

# API-Basis (Fastify)
API_BASE_URL=http://localhost:4000

# CORS-Quelle(n), die der API-Server akzeptiert (server.ts erwartet WEB_ORIGIN)
WEB_ORIGIN=http://localhost:3001

# (Optional) alternative Alias-Variablen aus älteren Protokollen
WEB_APP_URL=http://localhost:3001
ADMIN_APP_URL=http://localhost:3001

################################################################################
# WEB (Next.js · Runtime)
################################################################################

# Client-Calls (fetch im Browser)
NEXT_PUBLIC_API_URL=http://localhost:4000

# SSR lädt Theme-Overrides vom Server (Layout injiziert <style>)
NEXT_PUBLIC_THEME_FROM_API=1

################################################################################
# SERVER (API)
################################################################################

PORT=4000
HOST=0.0.0.0

# DEV-Flag: erlaubt Speichern im Theme-Drawer für JEDEN eingeloggten User
# (nur development/test; in production wird es IGNORIERT)
DEV_RELAX_THEME=1

################################################################################
# DATABASE (PostgreSQL / Prisma)
################################################################################

# Lokale Dev-DB (Docker): Benutzer=gatebook, Passwort=gatebook
DATABASE_URL=postgresql://gatebook:gatebook@localhost:5432/gatebook?schema=public

################################################################################
# SMTP (Dev: MailHog)
################################################################################

SMTP_HOST=127.0.0.1
SMTP_PORT=1025
SMTP_USER=
SMTP_PASS=
MAIL_FROM=no-reply@gatebook.local

################################################################################
# SESSIONS / COOKIES (HttpOnly)
################################################################################

# Cookie-Name für Session (muss zur API-Config passen)
SESSION_COOKIE_NAME=gb_session

# Signatur/Encryption-Secret (DEV-Platzhalter; in PROD stark setzen)
SESSION_SECRET=change-me-in-dev

# Session-Lebensdauer (Sekunden) – W1 Default: 12h
SESSION_TTL_SEC=43200

# Verify-Token-TTL (Sekunden) – Muss: 24h
VERIFY_TTL_SEC=86400

# Cookie-Policy (DEV/PROD)
NODE_ENV=development
COOKIE_SECURE=false
COOKIE_SAMESITE=lax

################################################################################
# HINWEISE / SCHNELLTEST (DEV)
################################################################################
# 1) Datei als ".env" ins Repo-Root kopieren.
# 2) Docker-Infra starten (DB/MailHog):
#       docker compose -f infra/docker/docker-compose.dev.yml up -d
# 3) Prisma migrieren/generieren:
#       pnpm dlx prisma migrate dev --schema services/api/prisma/schema.prisma
#       pnpm prisma generate --schema services/api/prisma/schema.prisma
# 4) API starten (aus Repo-Root; lädt .env):
#       $env:NODE_ENV='development'
#       pnpm dlx tsx services\api\src\start.ts
# 5) Web starten:
#       cd apps\web
#       pnpm dev   # http://localhost:3001
# 6) Theme-Flow prüfen:
#       Dashboard → „Layout anpassen“ → Palette/Color wählen → Speichern
#       (DEV_RELAX_THEME=1 vermeidet 403; in PROD nur superadmin)

################################################################################
# REFERENZBLOCK (Kap. 17.4 · SSOT)
################################################################################
# GateBook Enterprise – Geschäftslogik & Rollenhandbuch v1.0
# • Kap. 5.2–5.3  — UI-Tokenisierung & neutrale Komponenten
# • Kap. 11       — SSR/Next.js & API-Integration
# • Kap. 13.1–13.4— Sessions/Cookies (HttpOnly, SameSite, Secure)
# • Kap. 16       — Settings/Theme (key="theme:global"), Server-Overrides
# • Kap. 28       — SemVer/Wirksamkeit (W1-Feinfix: DEV-Guard via DEV_RELAX_THEME)
#
# Orchestrator-Handover (Einzeiler)
# powershell -NoProfile -ExecutionPolicy Bypass -File scripts/orch/update_handover.ps1 `
#   -Chat ADM `
#   -Gate "Gate A" `
#   -Status "delivered — .env.example aktualisiert (Ports 3001/4000; Theme-Flags; CORS)" `
#   -Deliverable ".env.example" `
#   -Summary "NEXT_PUBLIC_THEME_FROM_API=1 + DEV_RELAX_THEME=1; WEB_ORIGIN ergänzt; Speichern-Flow in DEV frei"
